---
aliases:
  - Session Affinity
  - Stickiness
---
# Overview
## Introduction
Strange name, huh?

It is possible to implement stickiness so that the same client is always redirected to the same instance behind a [[AWS Elastic Load Balancer#What is Load Balancing?|Load Balancer]].

Now, this sounds like what it should be doing, but recall that LBs care more about balancing the load than anything => every new request gets rebalanced to a different instance, and you might not get the same one.

Sticky Sessions allow the same user, when making repeated requests to an LB, to be redirected to the same instance.

This works for [[AWS Elastic Load Balancer#Types of load balancers on AWS|CLBs]], [[Application Load Balancer (v2)|ALBs]], and [[Network Load Balancer (v2)|NLBs]]. 

## How does it work?
Basically what it does is that every time you make a request, it sends a cookie as part of the request (NLB doesn't need cookies), and the cookie has an expiration date. 

When that cookie expires, the user may be sent to a different instance instead.

## Use case
Makes sure the user doesn't lose their session data.

## Downsides
Unbalanced load for the LB which defeats the purpose if overused. Also extra sticky users (mfs who refuse to log out for a single day).
# Cookies
We already know what [[cookies]] are so we will not explain it here, just discuss which ones are available.
- Application-based cookies
	- Custom cookie
		- Generated by the target (your app)
		- Can include any custom attributes you want/required by app
		- Cookie name must be specified individually for each TG
		- DO NOT USE these reserved names: `AWSALB`, `AWSALBAPP`, `AWSALBTG`
	- Application bookie
		- Generated by the LB
		- Cookie name is always `AWSALBAPP`
- Duration-based cookies
	- Generated by the LB
	- Cookie name is always `AWSALB` for ALB, `AWSELB` for CLB
	- Expired after a specific duration, specified by the LB itself.

## How to toggle
Target Groups -> Choose 1 -> Actions -> Edit attributes

You will now be in the `Edit target group attributes` page. 
Scroll down -> Target selection configuration -> Stickiness
